CREATE TABLE FUNCIONARIO
(
    MATRICULA NUMBER(9),
    SENHA VARCHAR(20),
    NASCIMENTO DATE,
    DATA_ADMISSAO DATE,
    SEXO VARCHAR(1),
    NOME VARCHAR(35),
    ENDERECO VARCHAR(35),
    SALARIO NUMBER(5),
    PRIMARY KEY (MATRICULA)
);



insert into FUNCIONARIO (MATRICULA,SENHA,NASCIMENTO,DATA_ADMISSAO,SEXO,NOME,ENDERECO,SALARIO)
select 123456389, '8734hrr', TO_DATE('07-JAN-56'), TO_DATE('07-JAN-99'),'M','ANTONIO', 'Rua Paulo', 10000 from dual
union all select 123456789, 'hf27834', TO_DATE('07-JAN-66'), TO_DATE('07-JAN-03'),'M','JOSE', 'Rua Julio', 5000 from dual;






CREATE TABLE EQUIPAMENTO
(
    IDENTIFICADOR NUMBER(9),
    DATA_AQUISICAO DATE,
    DESCRICAO VARCHAR(100),
    CUSTO_DIARIA NUMBER(10),
    PRIMARY KEY (IDENTIFICADOR)
);



insert into EQUIPAMENTO (IDENTIFICADOR,DATA_AQUISICAO,DESCRICAO,CUSTO_DIARIA) 
select 333, TO_DATE('2003/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), 'T', 23444 from dual
union all select 444, TO_DATE('2003/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), 'T', 23444 from dual;



CREATE TABLE RESERVAS(
    PROTOCOLO INT,
    MATRICULA NUMBER(9),
    IDENTIFICADOR NUMBER(9),
    DATA_INICIO DATE,
    DATA_TERMINO DATE,
    PRIMARY KEY (PROTOCOLO),
    CONSTRAINT FK_MATRICULA FOREIGN KEY (MATRICULA) REFERENCES FUNCIONARIO (MATRICULA),
    CONSTRAINT FK_IDENTIFICADOR FOREIGN KEY (IDENTIFICADOR) REFERENCES EQUIPAMENTO (IDENTIFICADOR)
);

insert into RESERVAS (PROTOCOLO,MATRICULA,IDENTIFICADOR,DATA_INICIO,DATA_TERMINO) 
select 885533, 123456389, 333 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/05 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual
union all select 9933333, 123456389, 444 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/05 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual
union all select 663333, 123456389, 333 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/04 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual;


insert into RESERVAS (PROTOCOLO,MATRICULA,IDENTIFICADOR,DATA_INICIO,DATA_TERMINO) 
select 899933, 123456789, 333 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/20 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual
union all select 663133, 123456789, 333 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/04 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual;


insert into RESERVAS (PROTOCOLO,MATRICULA,IDENTIFICADOR,DATA_INICIO,DATA_TERMINO) 
select 599633, 123456789, 333 , TO_DATE('2019/05/03 21:02:44', 'yyyy/mm/dd hh24:mi:ss'), TO_DATE('2019/05/10 21:02:44', 'yyyy/mm/dd hh24:mi:ss') from dual;




SELECT * FROM RESERVAS;
SELECT * FROM RESERVAS INNER JOIN FUNCIONARIO ON RESERVAS.MATRICULA = FUNCIONARIO.MATRICULA Where DATA_INICIO >= sysdate -1;


SELECT FUNCIONARIO.NOME, RESERVAS.IDENTIFICADOR , COUNT(*) 
FROM RESERVAS INNER JOIN FUNCIONARIO ON RESERVAS.MATRICULA = FUNCIONARIO.MATRICULA  
WHERE IDENTIFICADOR = 333 group by FUNCIONARIO.NOME, RESERVAS.IDENTIFICADOR;


SELECT RESERVAS.IDENTIFICADOR , Count(*) 
FROM RESERVAS 
INNER JOIN EQUIPAMENTO ON RESERVAS.IDENTIFICADOR = EQUIPAMENTO.IDENTIFICADOR
group by RESERVAS.IDENTIFICADOR, EQUIPAMENTO.CUSTO_DIARIA ;


SELECT distinct FUNCIONARIO.MATRICULA, 
COUNT(FUNCIONARIO.MATRICULA), 
SUM(EQUIPAMENTO.CUSTO_DIARIA *( RESERVAS.DATA_TERMINO - RESERVAS.DATA_INICIO)) TT 
FROM FUNCIONARIO
INNER JOIN RESERVAS ON FUNCIONARIO.MATRICULA = RESERVAS.MATRICULA
INNER JOIN EQUIPAMENTO ON RESERVAS.IDENTIFICADOR = EQUIPAMENTO.IDENTIFICADOR
GROUP BY FUNCIONARIO.MATRICULA
ORDER BY TT ;



SELECT IDENTIFICADOR
FROM RESERVAS
WHERE ( RESERVAS.DATA_TERMINO - RESERVAS.DATA_INICIO) = (
SELECT MAX ( RESERVAS.DATA_TERMINO - RESERVAS.DATA_INICIO) FROM RESERVAS);



--DROP TABLE RESERVAS;
--DROP TABLE FUNCIONARIO;
--DROP TABLE EQUIPAMENTO;
